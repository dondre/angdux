"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const rxjs_1 = require("rxjs");
const interfaces_1 = require("./interfaces");
const loadProps = (model) => {
    const _properties = new interfaces_1.Dictionary();
    Object.keys(model).forEach(key => _properties.add(key, new rxjs_1.BehaviorSubject(model[key])));
    return _properties;
};
const loadActions = (actions) => {
    const _actions = new interfaces_1.Dictionary();
    Object.keys(actions).forEach(key => _actions.add(key, actions[key]));
    return _actions;
};
const setState = (properties) => {
    return (state) => {
        if (!state)
            return;
        Object.keys(state).forEach(key => {
            const prop = properties.item(key);
            if (prop && prop.value !== state[key]) {
                prop.next(state[key]);
            }
        });
    };
};
const getState = (props) => {
    let state = {};
    props.keys().forEach(key => {
        if (props.item(key))
            state[key] = props.item(key).value;
    });
    return state;
};
exports.merge = (state, message) => {
    let merge = {};
    Object.keys(state).forEach(key => {
        merge[key] = state[key];
    });
    Object.keys(message).forEach(key => {
        if (key != "type")
            merge[key] = message[key];
    });
    return merge;
};
exports.createStore = (initialState, actions) => {
    let properties = loadProps(initialState);
    actions = loadActions(actions);
    return {
        properties,
        actions
    };
};
exports.dispatcher = (props, reducer) => {
    return (message) => {
        const currentState = getState(props);
        const state = reducer(currentState, message);
        setState(props)(state);
    };
};
function Angdux(store) {
    return function (constructor) {
        const hooks = ['ngOnInit', 'ngOnChanges', 'ngOnDestroy'];
        hooks.forEach(hook => {
            const original = constructor.prototype[hook];
            switch (hook) {
                case "ngOnInit":
                    constructor.prototype['ngOnInit'] = function (...args) {
                        let scope = this;
                        store.properties.keys().forEach(key => {
                            store.properties.item(key)
                                .asObservable()
                                .subscribe(next => {
                                scope[key] = next;
                            });
                        });
                        store.actions.keys().forEach(key => {
                            scope[key] = store.actions.item(key);
                        });
                        original && original.apply(scope, args);
                    };
                    break;
                case "ngOnChanges":
                    constructor.prototype['ngOnChanges'] = function (...args) {
                        let scope = this;
                        original && original.apply(scope, args);
                    };
                    break;
                case "ngOnDestroy":
                    constructor.prototype['ngOnDestroy'] = function (...args) {
                        let scope = this;
                        store.properties.values()
                            .forEach(p => p.next(null));
                        original && original.apply(scope, args);
                    };
                    break;
            }
        });
    };
}
exports.Angdux = Angdux;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtCQUF1QztBQUN2Qyw2Q0FBMEM7QUFHMUMsTUFBTSxTQUFTLEdBQUcsQ0FBQyxLQUFVLEVBQUUsRUFBRTtJQUM3QixNQUFNLFdBQVcsR0FBRyxJQUFJLHVCQUFVLEVBQXdCLENBQUM7SUFDM0QsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FDN0IsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsSUFBSSxzQkFBZSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQ3hELENBQUM7SUFDRixNQUFNLENBQUMsV0FBVyxDQUFDO0FBQ3ZCLENBQUMsQ0FBQTtBQUVELE1BQU0sV0FBVyxHQUFHLENBQUMsT0FBWSxFQUFFLEVBQUU7SUFDakMsTUFBTSxRQUFRLEdBQUcsSUFBSSx1QkFBVSxFQUFPLENBQUM7SUFDdkMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FDL0IsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQ2xDLENBQUM7SUFDRixNQUFNLENBQUMsUUFBUSxDQUFDO0FBQ3BCLENBQUMsQ0FBQTtBQUVELE1BQU0sUUFBUSxHQUFHLENBQUMsVUFBNEMsRUFBRyxFQUFFO0lBQy9ELE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1FBQ2IsRUFBRSxDQUFBLENBQUMsQ0FBQyxLQUFLLENBQUM7WUFBQyxNQUFNLENBQUM7UUFDbEIsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDN0IsTUFBTSxJQUFJLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxH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LENBQUMsQ0FBQyxDQUFBO3dCQUMvQixRQUFRLElBQUksUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7b0JBQzVDLENBQUMsQ0FBQTtvQkFDRCxLQUFLLENBQUM7WUFDVixDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDLENBQUE7QUFDTCxDQUFDO0FBeENELHdCQXdDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgRGljdGlvbmFyeSB9IGZyb20gJy4vaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBUeXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmNvbnN0IGxvYWRQcm9wcyA9IChtb2RlbDogYW55KSA9PiB7XG4gICAgY29uc3QgX3Byb3BlcnRpZXMgPSBuZXcgRGljdGlvbmFyeTxCZWhhdmlvclN1YmplY3Q8YW55Pj4oKTtcbiAgICBPYmplY3Qua2V5cyhtb2RlbCkuZm9yRWFjaChrZXkgPT4gXG4gICAgICAgIF9wcm9wZXJ0aWVzLmFkZChrZXksIG5ldyBCZWhhdmlvclN1YmplY3QobW9kZWxba2V5XSkpXG4gICAgKTtcbiAgICByZXR1cm4gX3Byb3BlcnRpZXM7XG59XG5cbmNvbnN0IGxvYWRBY3Rpb25zID0gKGFjdGlvbnM6IGFueSkgPT4ge1xuICAgIGNvbnN0IF9hY3Rpb25zID0gbmV3IERpY3Rpb25hcnk8YW55PigpO1xuICAgIE9iamVjdC5rZXlzKGFjdGlvbnMpLmZvckVhY2goa2V5ID0+IFxuICAgICAgICBfYWN0aW9ucy5hZGQoa2V5LCBhY3Rpb25zW2tleV0pXG4gICAgKTtcbiAgICByZXR1cm4gX2FjdGlvbnM7XG59XG5cbmNvbnN0IHNldFN0YXRlID0gKHByb3BlcnRpZXM6IERpY3Rpb25hcnk8QmVoYXZpb3JTdWJqZWN0PGFueT4+KSAgPT4ge1xuICAgIHJldHVybiAoc3RhdGUpID0+IHtcbiAgICAgICAgaWYoIXN0YXRlKSByZXR1cm47XG4gICAgICAgIE9iamVjdC5rZXlzKHN0YXRlKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwcm9wID0gcHJvcGVydGllcy5pdGVtKGtleSk7XG4gICAgICAgICAgICBpZihwcm9wICYmIHByb3AudmFsdWUgIT09IHN0YXRlW2tleV0pIHtcbiAgICAgICAgICAgICAgICBwcm9wLm5leHQoc3RhdGVba2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxufVxuXG5jb25zdCBnZXRTdGF0ZSA9IChwcm9wczogRGljdGlvbmFyeTxCZWhhdmlvclN1YmplY3Q8YW55Pj4pID0+IHtcbiAgICBsZXQgc3RhdGUgPSB7fTtcbiAgICBwcm9wcy5rZXlzKCkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICBpZihwcm9wcy5pdGVtKGtleSkpXG4gICAgICAgICAgICBzdGF0ZVtrZXldID0gcHJvcHMuaXRlbShrZXkpLnZhbHVlO1xuICAgIH0pXG4gICAgcmV0dXJuIHN0YXRlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElTdG9yZXtcbiAgICBwcm9wZXJ0aWVzOiBEaWN0aW9uYXJ5PEJlaGF2aW9yU3ViamVjdDxhbnk+PjtcbiAgICBhY3Rpb25zOiBEaWN0aW9uYXJ5PGFueT47XG59XG5cbmV4cG9ydCBjb25zdCBtZXJnZSA9IChzdGF0ZSwgbWVzc2FnZSkgPT4ge1xuICAgIGxldCBtZXJnZSA9IHt9O1xuICAgIE9iamVjdC5rZXlzKHN0YXRlKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgIG1lcmdlW2tleV0gPSBzdGF0ZVtrZXldO1xuICAgIH0pO1xuICAgIE9iamVjdC5rZXlzKG1lc3NhZ2UpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgaWYoa2V5ICE9IFwidHlwZVwiKVxuICAgICAgICAgICAgbWVyZ2Vba2V5XSA9IG1lc3NhZ2Vba2V5XTtcbiAgICB9KVxuICAgIHJldHVybiBtZXJnZTtcbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZVN0b3JlID0oaW5pdGlhbFN0YXRlLCBhY3Rpb25zKSA6IElTdG9yZSA9PiB7XG4gICAgbGV0IHByb3BlcnRpZXMgPSBsb2FkUHJvcHMoaW5pdGlhbFN0YXRlKTtcbiAgICBhY3Rpb25zID0gbG9hZEFjdGlvbnMoYWN0aW9ucyk7XG5cbiAgIHJldHVybiB7XG4gICAgICAgIHByb3BlcnRpZXMsXG4gICAgICAgIGFjdGlvbnNcbiAgICB9O1xufVxuXG5leHBvcnQgY29uc3QgZGlzcGF0Y2hlciA9IChwcm9wcywgcmVkdWNlcikgPT4ge1xuICAgIHJldHVybiAobWVzc2FnZSkgPT4gIHtcbiAgICAgICAgY29uc3QgY3VycmVudFN0YXRlID0gZ2V0U3RhdGUocHJvcHMpO1xuICAgICAgICBjb25zdCBzdGF0ZSA9IHJlZHVjZXIoY3VycmVudFN0YXRlLCBtZXNzYWdlKTtcbiAgICAgICAgc2V0U3RhdGUocHJvcHMpKHN0YXRlKTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBBbmdkdXg8VD4oc3RvcmU6SVN0b3JlKSA6IENsYXNzRGVjb3JhdG9yIHtcblxuICAgIHJldHVybiBmdW5jdGlvbiAoIGNvbnN0cnVjdG9yOmFueSApIHtcbiAgICAgICAgY29uc3QgaG9va3MgPSBbJ25nT25Jbml0JywgJ25nT25DaGFuZ2VzJywgJ25nT25EZXN0cm95J107XG4gICAgICAgIGhvb2tzLmZvckVhY2goaG9vayA9PiB7XG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbCA9IGNvbnN0cnVjdG9yLnByb3RvdHlwZVtob29rXTtcbiAgICAgICAgICAgIHN3aXRjaChob29rKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm5nT25Jbml0XCI6XG4gICAgICAgICAgICAgICAgY29uc3RydWN0b3IucHJvdG90eXBlWyduZ09uSW5pdCddID0gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHNjb3BlID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUucHJvcGVydGllcy5rZXlzKCkuZm9yRWFjaChrZXkgID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JlLnByb3BlcnRpZXMuaXRlbShrZXkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFzT2JzZXJ2YWJsZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnN1YnNjcmliZShuZXh0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGVba2V5XSA9IG5leHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLmFjdGlvbnMua2V5cygpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlW2tleV0gPSBzdG9yZS5hY3Rpb25zLml0ZW0oa2V5KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWwgJiYgb3JpZ2luYWwuYXBwbHkoc2NvcGUsIGFyZ3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwibmdPbkNoYW5nZXNcIjpcbiAgICAgICAgICAgICAgICBjb25zdHJ1Y3Rvci5wcm90b3R5cGVbJ25nT25DaGFuZ2VzJ10gPSBmdW5jdGlvbiAoLi4uYXJncykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgc2NvcGUgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbCAmJiBvcmlnaW5hbC5hcHBseShzY29wZSwgYXJncyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJuZ09uRGVzdHJveVwiOlxuICAgICAgICAgICAgICAgIGNvbnN0cnVjdG9yLnByb3RvdHlwZVsnbmdPbkRlc3Ryb3knXSA9IGZ1bmN0aW9uICguLi5hcmdzKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzY29wZSA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLnByb3BlcnRpZXMudmFsdWVzKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKHAgPT4gcC5uZXh0KG51bGwpKVxuICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbCAmJiBvcmlnaW5hbC5hcHBseShzY29wZSwgYXJncyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH1cbn1cblxuIl19